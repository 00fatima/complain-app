<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Campus Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .sidebar-item {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sidebar-item.active {
            background-color: #f3f4f6;
            border-left: 4px solid #3b82f6;
            color: #1f2937;
            font-weight: 500;
        }
        .sidebar-item:hover:not(.active) {
            background-color: #f9fafb;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .action-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        .btn-purple {
            background-color: #8b5cf6;
            color: white;
        }
        .btn-purple:hover {
            background-color: #7c3aed;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-resolved {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-found {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .table-header {
            background-color: #f9fafb;
            padding: 12px 16px;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }
        .table-row {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s;
        }
        .table-row:hover {
            background-color: #f9fafb;
        }
        .filter-select {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            color: #374151;
            background-color: white;
        }
        .resolve-btn {
            background-color: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        .resolve-btn:hover {
            background-color: #059669;
        }
        .admin-badge {
            background-color: #8b5cf6;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* Responsive Styles */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            .main-content {
                margin-left: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                padding: 16px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            .action-buttons {
                flex-direction: column;
            }
            .action-btn {
                width: 100%;
            }
            .table-header {
                display: none;
            }
            .table-row {
                grid-template-columns: 1fr !important;
                gap: 8px;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                margin-bottom: 12px;
            }
            .filter-section {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Mobile Menu Button -->
    <button id="menuToggle" class="lg:hidden fixed top-4 left-4 z-50 bg-white p-2 rounded-lg shadow-lg">
        <i class="fas fa-bars text-gray-600 text-xl"></i>
    </button>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-72 bg-white shadow-lg fixed h-full transition-transform duration-300 lg:translate-x-0" id="sidebar">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-800">Campus Portal</h1>
                <p class="text-sm text-gray-500 mt-2">Manage reports, complaints & events in one place.</p>
            </div>
            
            <div class="mt-4">
                <div class="sidebar-item" onclick="showDashboard(); closeSidebarOnMobile()" id="menu-dashboard">
                    <i class="fas fa-chart-pie w-5"></i>
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-item" onclick="showLostFound(); closeSidebarOnMobile()" id="menu-lostfound">
                    <i class="fas fa-search w-5"></i>
                    <span>Lost & Found</span>
                </div>
                <div class="sidebar-item active" onclick="showComplaints(); closeSidebarOnMobile()" id="menu-complaints">
                    <i class="fas fa-exclamation-triangle w-5"></i>
                    <span>Complaints</span>
                </div>
                <div class="sidebar-item" onclick="showVolunteers(); closeSidebarOnMobile()" id="menu-volunteers">
                    <i class="fas fa-hands-helping w-5"></i>
                    <span>Volunteers</span>
                </div>
                <div class="sidebar-item" onclick="showNotifications(); closeSidebarOnMobile()" id="menu-notifications">
                    <i class="fas fa-bell w-5"></i>
                    <span>Notifications</span>
                </div>
            </div>

            <div class="absolute bottom-0 w-72 p-6 border-t">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium" id="userEmail">Loading...</p>
                        <p class="text-xs text-gray-500" id="userRole">Loading...</p>
                    </div>
                    <button onclick="logout()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content flex-1 lg:ml-72 p-4 lg:p-8">
            <h1 class="text-2xl lg:text-3xl font-bold text-gray-800 mb-6" id="pageTitle">Complaints</h1>

            <!-- Stats Cards - Responsive Grid -->
            <div class="stats-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-8" id="statsSection">
                <div class="stat-card">
                    <p class="text-sm text-gray-500 mb-2">Total Reports</p>
                    <p class="text-2xl lg:text-3xl font-bold" id="totalReports">0</p>
                </div>
                <div class="stat-card">
                    <p class="text-sm text-gray-500 mb-2">Active Complaints</p>
                    <p class="text-2xl lg:text-3xl font-bold" id="activeComplaints">0</p>
                </div>
                <div class="stat-card">
                    <p class="text-sm text-gray-500 mb-2">Items Matched</p>
                    <p class="text-2xl lg:text-3xl font-bold" id="itemsMatched">0</p>
                </div>
                <div class="stat-card">
                    <p class="text-sm text-gray-500 mb-2">Events Registered</p>
                    <p class="text-2xl lg:text-3xl font-bold" id="eventsRegistered">0</p>
                </div>
            </div>

            <!-- Action Buttons - Responsive -->
            <div class="action-buttons flex flex-col sm:flex-row gap-3 lg:gap-4 mb-8" id="actionButtons">
                <button onclick="showLostFoundForm()" class="action-btn btn-primary w-full sm:w-auto">
                    <i class="fas fa-plus mr-2"></i>Report Lost Item
                </button>
                <button onclick="showComplaintForm()" class="action-btn btn-success w-full sm:w-auto">
                    <i class="fas fa-exclamation mr-2"></i>Submit Complaint
                </button>
                <button onclick="showEventForm()" class="action-btn btn-purple w-full sm:w-auto">
                    <i class="fas fa-calendar-plus mr-2"></i>Register for Event
                </button>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="hidden">
                <div class="bg-white rounded-lg shadow-sm p-4 lg:p-6 mb-8">
                    <h2 class="text-lg lg:text-xl font-bold mb-4">Recent Activity</h2>
                    <div class="space-y-3" id="recentActivity"></div>
                </div>
            </div>

            <!-- Complaints Section -->
            <div id="complaintsSection">
                <!-- Submit Complaint Form -->
                <div class="bg-white rounded-lg shadow-sm p-4 lg:p-6 mb-8 w-full lg:max-w-2xl">
                    <h2 class="text-xl lg:text-2xl font-bold mb-6">Submit Complaint</h2>
                    
                    <form id="complaintForm">
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Complaint Title</label>
                            <input type="text" id="complaintTitle" required 
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                   placeholder="Enter complaint title">
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Category</label>
                            <select id="complaintCategory" required 
                                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Select Category</option>
                                <option value="Wi-Fi">Wi-Fi</option>
                                <option value="Infrastructure">Infrastructure</option>
                                <option value="Cleanliness">Cleanliness</option>
                                <option value="Security">Security</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Description</label>
                            <textarea id="complaintDescription" rows="3" required 
                                      class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                      placeholder="Describe your complaint"></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Location</label>
                            <input type="text" id="complaintLocation" required 
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                   placeholder="Where did this occur?">
                        </div>

                        <div class="mb-6">
                            <label class="block text-gray-700 mb-3">Urgency</label>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-6">
                                <label class="flex items-center">
                                    <input type="radio" name="complaintUrgency" value="Low" class="mr-2">
                                    <span>Low</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="complaintUrgency" value="Medium" class="mr-2">
                                    <span>Medium</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="complaintUrgency" value="High" class="mr-2" checked>
                                    <span>High</span>
                                </label>
                            </div>
                        </div>

                        <button type="button" onclick="submitComplaint()" class="action-btn btn-success w-full sm:w-auto">
                            Submit Complaint
                        </button>
                    </form>
                </div>

                <!-- My Complaints Table -->
                <div class="bg-white rounded-lg shadow-sm p-4 lg:p-6">
                    <div class="filter-section flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <h2 class="text-lg lg:text-xl font-bold">My Complaints</h2>
                        <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                            <select id="statusFilter" class="filter-select w-full sm:w-auto" onchange="filterComplaints()">
                                <option value="All">Status: All</option>
                                <option value="Pending">Pending</option>
                                <option value="Resolved">Resolved</option>
                            </select>
                            <select id="categoryFilter" class="filter-select w-full sm:w-auto" onchange="filterComplaints()">
                                <option value="All">Category: All</option>
                                <option value="Wi-Fi">Wi-Fi</option>
                                <option value="Infrastructure">Infrastructure</option>
                                <option value="Cleanliness">Cleanliness</option>
                                <option value="Security">Security</option>
                            </select>
                        </div>
                    </div>

                    <!-- Table Header - Hidden on mobile -->
                    <div class="hidden sm:grid grid-cols-12 table-header">
                        <div class="col-span-2">ID</div>
                        <div class="col-span-4">Complaints</div>
                        <div class="col-span-3">Location</div>
                        <div class="col-span-3">Status</div>
                    </div>

                    <!-- Table Body -->
                    <div id="complaintsList" class="space-y-3 sm:space-y-0">
                        <div class="text-center py-8 text-gray-500">No complaints found</div>
                    </div>
                </div>
            </div>

            <!-- Lost & Found Form - Complete Form -->
            <div id="lostFoundForm" class="hidden bg-white rounded-lg shadow-sm p-4 lg:p-6 w-full lg:max-w-2xl">
                <h2 class="text-xl lg:text-2xl font-bold mb-6">Report Lost Item</h2>
                
                <form id="lostItemForm">
                    <!-- Item Name -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Item Name</label>
                        <input type="text" id="itemName" required 
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                               placeholder="Enter item name">
                    </div>

                    <!-- Category -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Category</label>
                        <select id="category" required 
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="">Select Category</option>
                            <option value="Meturx">Meturx</option>
                            <option value="Elistworice">Elistworice</option>
                            <option value="Phone">Phone</option>
                            <option value="Backpack">Backpack</option>
                            <option value="Wallet">Wallet</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Keys">Keys</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <!-- Description -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Description</label>
                        <textarea id="description" rows="3" required 
                                  class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                  placeholder="Describe the item"></textarea>
                    </div>

                    <!-- Location -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Location</label>
                        <input type="text" id="location" required 
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                               placeholder="Where was it lost/found?">
                    </div>

                    <!-- Urgency -->
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-3">Urgency</label>
                        <div class="flex flex-col sm:flex-row gap-3 sm:gap-6">
                            <label class="flex items-center">
                                <input type="radio" name="urgency" value="Low" class="mr-2">
                                <span>Low</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="urgency" value="Medium" class="mr-2">
                                <span>Medium</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="urgency" value="High" class="mr-2" checked>
                                <span>High</span>
                            </label>
                        </div>
                    </div>

                    <!-- Submit and Cancel Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button type="button" onclick="submitLostItem()" class="action-btn btn-primary w-full sm:w-auto">
                            Report Lost Item
                        </button>
                        <button type="button" onclick="hideLostFoundForm()" class="action-btn bg-gray-200 text-gray-700 hover:bg-gray-300 w-full sm:w-auto">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        import { supabase } from './config.js';

        let currentUser = null;
        let allComplaints = [];

        // Mobile menu toggle
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
        });

        window.closeSidebarOnMobile = function() {
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        };

        // Check authentication
        async function checkAuth() {
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                if (error) throw error;
                if (!user) {
                    window.location.href = 'login.html';
                    return null;
                }
                currentUser = user;
                document.getElementById('userEmail').textContent = user.email;
                
                // Check admin status
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('role')
                    .eq('id', user.id)
                    .maybeSingle();
                
                window.isAdmin = profile?.role === 'admin';
                document.getElementById('userRole').textContent = window.isAdmin ? 'Admin' : 'User';
                
                // Load dashboard data and complaints
                loadDashboardData();
                loadComplaints();
                return user;
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = 'login.html';
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Get total reports
                const { count: totalReports } = await supabase
                    .from('lost_found_items')
                    .select('*', { count: 'exact', head: true });

                // Get active complaints
                const { count: activeComplaints } = await supabase
                    .from('complaints')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'Pending');

                // Get items matched
                const { count: itemsMatched } = await supabase
                    .from('lost_found_items')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'Found');

                // Get events registered
                const { count: eventsRegistered } = await supabase
                    .from('event_registrations')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', currentUser?.id);

                document.getElementById('totalReports').textContent = totalReports || 0;
                document.getElementById('activeComplaints').textContent = activeComplaints || 0;
                document.getElementById('itemsMatched').textContent = itemsMatched || 0;
                document.getElementById('eventsRegistered').textContent = eventsRegistered || 0;

                // Load recent activity
                loadRecentActivity();
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const { data: items, error } = await supabase
                    .from('lost_found_items')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(5);

                if (error) throw error;

                const activityHtml = items?.map(item => `
                    <div class="activity-item p-3 bg-gray-50 rounded-lg flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-${getItemIcon(item.category)} text-blue-600"></i>
                            </div>
                            <div>
                                <p class="font-medium">${item.item_name}</p>
                                <p class="text-sm text-gray-500">${item.location || 'No location'}</p>
                            </div>
                        </div>
                        <span class="status-badge ${item.status === 'Pending' ? 'status-pending' : 'status-found'}">
                            ${item.status}
                        </span>
                    </div>
                `).join('') || '<p class="text-gray-500">No recent activity</p>';

                document.getElementById('recentActivity').innerHTML = activityHtml;
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }

        // ============== FIXED COMPLAINTS FUNCTIONS ==============

        // Load complaints - FIXED
        async function loadComplaints() {
            try {
                let query = supabase
                    .from('complaints')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (!window.isAdmin) {
                    query = query.eq('user_id', currentUser?.id);
                }

                const { data, error } = await query;
                if (error) throw error;
                
                allComplaints = data || [];
                displayComplaints(allComplaints);
            } catch (error) {
                console.error('Error loading complaints:', error);
                document.getElementById('complaintsList').innerHTML = 
                    '<div class="text-center py-8 text-red-500">Error loading complaints</div>';
            }
        }

        // Display complaints - FIXED (handles both title and complaint_title)
        function displayComplaints(complaints) {
            if (!complaints || complaints.length === 0) {
                document.getElementById('complaintsList').innerHTML = 
                    '<div class="text-center py-8 text-gray-500">No complaints found</div>';
                return;
            }

            const html = complaints.map(c => {
                // Use whichever title field is available
                const displayTitle = c.complaint_title || c.title || 'No title';
                
                return `
                <div class="block sm:grid grid-cols-12 table-row p-4 sm:p-3">
                    <div class="sm:hidden text-xs text-gray-500 mb-1">ID: ${c.id?.slice(0, 8) || 'N/A'}</div>
                    <div class="sm:col-span-2 hidden sm:block font-mono text-sm">${c.id?.slice(0, 8) || 'N/A'}</div>
                    <div class="sm:col-span-4 mb-2 sm:mb-0">
                        <div class="font-medium">${displayTitle}</div>
                        <div class="text-xs text-gray-500">${c.category || 'No category'}</div>
                    </div>
                    <div class="sm:col-span-3 text-sm mb-2 sm:mb-0">
                        <span class="sm:hidden font-medium">Location: </span>${c.location || 'Not specified'}
                    </div>
                    <div class="sm:col-span-3">
                        <span class="status-badge ${c.status === 'Pending' ? 'status-pending' : 'status-resolved'}">
                            ${c.status || 'Pending'}
                        </span>
                    </div>
                </div>
            `}).join('');

            document.getElementById('complaintsList').innerHTML = html;
        }

        // Submit complaint - FIXED (inserts into both columns)
        window.submitComplaint = async function() {
            try {
                if (!currentUser) {
                    throw new Error('Please login first');
                }

                const form = document.getElementById('complaintForm');
                const title = document.getElementById('complaintTitle').value;
                const category = document.getElementById('complaintCategory').value;
                const description = document.getElementById('complaintDescription').value;
                const location = document.getElementById('complaintLocation').value;
                const urgency = document.querySelector('input[name="complaintUrgency"]:checked')?.value;

                if (!title || !category || !description || !location) {
                    throw new Error('Please fill all fields');
                }

                // Insert into BOTH columns to be safe
                const complaintData = {
                    user_id: currentUser.id,
                    title: title,                 // for title column
                    complaint_title: title,       // for complaint_title column
                    category: category,
                    description: description,
                    location: location,
                    urgency: urgency,
                    status: 'Pending'
                };

                console.log('Submitting complaint:', complaintData);

                const { error } = await supabase
                    .from('complaints')
                    .insert([complaintData]);

                if (error) {
                    console.error('Insert error:', error);
                    throw error;
                }

                await Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Complaint submitted successfully',
                    timer: 1500,
                    showConfirmButton: false
                });

                form.reset();
                loadComplaints();
                
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message || 'Failed to submit complaint'
                });
            }
        };

        // Filter complaints
        window.filterComplaints = function() {
            const statusFilter = document.getElementById('statusFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;

            let filtered = [...allComplaints];

            if (statusFilter !== 'All') {
                filtered = filtered.filter(c => c.status === statusFilter);
            }
            if (categoryFilter !== 'All') {
                filtered = filtered.filter(c => c.category === categoryFilter);
            }

            displayComplaints(filtered);
        };

        // ============== LOST & FOUND FUNCTIONS ==============

        // Submit lost item
        window.submitLostItem = async function() {
            try {
                if (!currentUser) {
                    throw new Error('Please login first');
                }

                const form = document.getElementById('lostItemForm');
                const itemName = document.getElementById('itemName').value;
                const category = document.getElementById('category').value;
                const description = document.getElementById('description').value;
                const location = document.getElementById('location').value;
                const urgency = document.querySelector('input[name="urgency"]:checked')?.value;

                if (!itemName || !category || !description || !location) {
                    throw new Error('Please fill all fields');
                }

                const itemData = {
                    user_id: currentUser.id,
                    item_name: itemName,
                    category: category,
                    description: description,
                    location: location,
                    urgency: urgency,
                    status: 'Pending'
                };

                const { error } = await supabase
                    .from('lost_found_items')
                    .insert([itemData]);

                if (error) throw error;

                await Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Lost item reported successfully',
                    timer: 1500,
                    showConfirmButton: false
                });

                form.reset();
                showDashboard();
                
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message || 'Failed to report lost item'
                });
            }
        };

        // ============== UI FUNCTIONS ==============

        window.showComplaints = function() {
            document.getElementById('pageTitle').textContent = 'Complaints';
            document.getElementById('complaintsSection').classList.remove('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('lostFoundForm').classList.add('hidden');
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            document.getElementById('menu-complaints').classList.add('active');
            
            loadComplaints();
        };

        window.showDashboard = function() {
            document.getElementById('pageTitle').textContent = 'Dashboard';
            document.getElementById('complaintsSection').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            document.getElementById('lostFoundForm').classList.add('hidden');
            document.getElementById('statsSection').classList.remove('hidden');
            document.getElementById('actionButtons').classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            document.getElementById('menu-dashboard').classList.add('active');
            
            loadDashboardData();
        };

        window.showLostFound = function() {
            document.getElementById('pageTitle').textContent = 'Lost & Found';
            document.getElementById('complaintsSection').classList.add('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('lostFoundForm').classList.remove('hidden');
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            document.getElementById('menu-lostfound').classList.add('active');
        };

        window.showLostFoundForm = window.showLostFound;
        window.hideLostFoundForm = window.showDashboard;
        window.showComplaintForm = window.showComplaints;
        
        window.showVolunteers = () => Swal.fire('Coming Soon', 'Volunteers module coming soon!', 'info');
        window.showNotifications = () => Swal.fire('Coming Soon', 'Notifications module coming soon!', 'info');
        window.showEventForm = () => Swal.fire('Coming Soon', 'Event registration coming soon!', 'info');

        window.logout = async () => {
            await supabase.auth.signOut();
            window.location.href = 'login.html';
        };

        function getItemIcon(category) {
            const icons = {
                'Phone': 'mobile-alt',
                'Backpack': 'backpack',
                'Wallet': 'wallet',
                'Laptop': 'laptop',
                'Keys': 'key',
                'Meturx': 'box',
                'Elistworice': 'box'
            };
            return icons[category] || 'box';
        }

        // Initialize
        checkAuth();
    </script>
</body>
</html>